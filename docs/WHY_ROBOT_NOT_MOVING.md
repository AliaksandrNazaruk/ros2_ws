# Почему робот не двигается

## Текущая ситуация

**Робот НЕ двигается**, хотя:
- ✅ MQTT коммуникация работает
- ✅ Команды отправляются и принимаются
- ✅ Nav2 принимает цели (`ack(accepted)`)
- ✅ Все события публикуются корректно

## Основная проблема

**Nav2 прерывает навигацию сразу после принятия цели** (`NAV_GOAL_ABORTED` с error_code 6 = `CONTROLLER_TIMED_OUT`).

## Причины

### 1. ❌ Нет данных от Symovo API

**Проблема:** `base_controller` не получает данные от Symovo API (`/v0/agv`), поэтому:
- Не публикуется `/odom`
- Не публикуется TF `odom -> base_link`
- Nav2 не может определить позицию робота

**Решение:**
- Подключиться к реальному Symovo API
- ИЛИ использовать `mock_odom_publisher.py` для тестирования (но это только для тестирования, робот не будет двигаться физически)

### 2. ⚠️ Планировщик и контроллер не активированы

**Проблема:** `planner_server` и `controller_server` могут быть в состоянии `inactive`.

**Решение:**
```bash
ros2 lifecycle set /planner_server activate
ros2 lifecycle set /controller_server activate
```

### 3. ⚠️ Нет локализации

**Проблема:** AMCL может не знать позицию робота в карте.

**Решение:**
```bash
python3 scripts/set_initial_pose.py 0.0 0.0 0.0
```

### 4. ⚠️ Нет карты или карта не загружена

**Проблема:** Nav2 не может планировать путь без карты.

**Решение:** Убедиться, что карта загружена через `map_server`.

## Что работает

1. ✅ **MQTT цепочка** - полностью функциональна
2. ✅ **Валидация команд** - работает корректно
3. ✅ **Обработка ошибок** - все ошибки обрабатываются и публикуются
4. ✅ **Отправка команд в Nav2** - Nav2 принимает цели
5. ✅ **Логирование** - все сообщения записываются в файлы

## Что НЕ работает

1. ❌ **Физическое движение робота** - робот не двигается, потому что:
   - Нет данных от Symovo API (или используется mock)
   - Nav2 прерывает навигацию из-за отсутствия данных/конфигурации

## Для реального движения робота нужно:

1. **Подключиться к реальному Symovo API:**
   - Убедиться, что Symovo API доступен по адресу из `launch/symovo_nav2.launch.py`
   - Убедиться, что API возвращает данные для настроенного `amr_id`

2. **Активировать все Nav2 компоненты:**
   ```bash
   ros2 lifecycle set /planner_server activate
   ros2 lifecycle set /controller_server activate
   ros2 lifecycle set /global_costmap activate
   ros2 lifecycle set /local_costmap activate
   ```

3. **Установить начальную позицию:**
   ```bash
   python3 scripts/set_initial_pose.py <x> <y> <yaw>
   ```

4. **Убедиться, что карта загружена:**
   ```bash
   ros2 topic echo /map --once
   ```

## Тестирование без реального робота

Для тестирования MQTT и Nav2 интеграции можно использовать:

```bash
# Запустить mock odom publisher
python3 scripts/mock_odom_publisher.py

# В другом терминале: установить начальную позицию
python3 scripts/set_initial_pose.py 0.0 0.0 0.0

# Отправить команду навигации
python3 scripts/send_navigation_command.py position_B
```

**НО:** Робот не будет двигаться физически, потому что mock publisher не отправляет команды на реальный робот.

## Вывод

**Система работает корректно на уровне MQTT и Nav2 интеграции**, но для реального движения робота нужно:
1. Подключиться к реальному Symovo API
2. Убедиться, что все Nav2 компоненты активированы
3. Убедиться, что карта загружена и локализация работает
